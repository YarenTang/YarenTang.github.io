<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Scala 与设计模式（二）：Builder 创建者模式 · Prefert</title><meta name="description" content="Scala 与设计模式（二）：Builder 创建者模式 - Prefert"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/avator.jpg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://prefer-tyl.site/atom.xml" title="Prefert"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/avator.jpg" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/YarenTang" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Scala 与设计模式（二）：Builder 创建者模式</h1><div class="post-info">Jul 20, 2017</div><div class="post-content"><p>创建者模式（Builder Pattern）支持以类方法而非类构造器的方式来创建实例。当一个类的构造器拥有多个版本以支持不同的用途时，这种模式尤其有用。</p>
<a id="more"></a>
<p>在 Java 开发中，你是否写过这样像蛇一样长的构造函数：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Robot robot = <span class="keyword">new</span> Robot(<span class="number">1</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>) <span class="comment">// Boolean 类型的参数表示 computer 是否含有对应固件</span></div></pre></td></tr></table></figure></p>
<p>刚写完时回头看发现能看懂，一天后回头看时已经忘记大半了，一个星期后：What The Fu*k？<br>当然有强（lan）迫（duo）症的同学肯定不能忍 ——— 他们会创造各种各样的便捷版！</p>
<p>本文会通过 Builder Pattern 来一步步解决上述以及更复杂的一些情况。</p>
<!-- 本篇文章结构如下： -->
<!-- - builder pattern 的概念 -->
<!-- - 问题分解 -->
<!-- - Java 实例 -->
<!-- - Scala 实例 -->
<!-- - 总结 -->
<!-- toc -->
<ul>
<li><a href="#概念">概念</a></li>
<li><a href="#它解决了什么问题">它解决了什么问题</a><ul>
<li><a href="#当大量参数遇上构造函数">当大量参数遇上构造函数</a></li>
<li><a href="#java-变种版">Java —— 变种版</a><ul>
<li><a href="#java-传统版">Java —— 传统版</a></li>
</ul>
<ul>
<li><a href="#builder-模式的构成">Builder 模式的构成</a></li>
<li><a href="#如何让构造的对象有不同表示">如何让构造的对象有不同表示</a></li>
<li><a href="#代码实现">代码实现</a></li>
<li><a href="#总结">总结</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#scala-实现">Scala 实现</a><ul>
<li><a href="#仿-java-版">仿 Java 版</a></li>
<li><a href="#case-class-版">case class 版</a></li>
<li><a href="#类型安全type-safe-版">类型安全(<code>type-safe</code>) 版</a></li>
<li><a href="#require-版">require 版</a></li>
</ul>
</li>
<li><a href="#总结-1">总结</a></li>
</ul>
<!-- tocstop -->
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>创建者模式与单例模式一样，也是「四人帮」设计模式中的一种，一般也译作「生成器模式」，定义如下：</p>
<blockquote>
<p>Separate the construction of a complex object from its representation so that the same construction process can create different representations.<br>   将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示。        </p>
</blockquote>
<h2 id="它解决了什么问题"><a href="#它解决了什么问题" class="headerlink" title="它解决了什么问题"></a>它解决了什么问题</h2><h4 id="当大量参数遇上构造函数"><a href="#当大量参数遇上构造函数" class="headerlink" title="当大量参数遇上构造函数"></a>当大量参数遇上构造函数</h4><p>我们都知道在 Java 中，每个类都至少有一个构造函数，如果我们没有明确声明构造函数，编译器会默认帮我们生成一个无参的构造函数。当然我们也可以根据参数写不同的构造函数。</p>
<p>在实际项目开发中，对象中的属性一般都是比较多的。当对象中有大量可选参数或者参数类型一致时（正如文章开头的例子），通常情况下创建前我们需要了解这个类的内部结构，然后我们忽略掉为空的参数或者用所需的参数写一个新的构造函数。</p>
<p>我们以「机器人」类为例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Robot</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String code;</div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> type;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> battery;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> ability;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">double</span> weight;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">double</span> height;</div><div class="line"></div><div class="line">    <span class="comment">// 通常我们会生成一个含有全部参数的构造函数</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Robot</span><span class="params">(String code, String name, <span class="keyword">int</span> type, <span class="keyword">int</span> battery, <span class="keyword">int</span> ability, <span class="keyword">double</span> weight, <span class="keyword">double</span> height)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.code = code;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">        <span class="keyword">this</span>.type = type;</div><div class="line">        <span class="keyword">this</span>.battery = battery;</div><div class="line">        <span class="keyword">this</span>.ability = ability;</div><div class="line">        <span class="keyword">this</span>.weight = weight;</div><div class="line">        <span class="keyword">this</span>.height = height;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"Robot &#123;"</span> +</div><div class="line">                <span class="string">"code = "</span> + code + <span class="string">'\''</span> +</div><div class="line">                <span class="string">", name = '"</span> + name + <span class="string">'\''</span> +</div><div class="line">                ... <span class="comment">// 省略部分</span></div><div class="line">                <span class="string">", height = '"</span> + height +</div><div class="line">                <span class="string">'&#125;'</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="comment">// Test</span></div><div class="line">Robot robot1 = <span class="keyword">new</span> Robot(<span class="string">"89757"</span>, <span class="string">"火星一号"</span>, <span class="number">1</span>, <span class="number">99</span>, <span class="number">250</span>, <span class="number">180</span>, <span class="number">180</span>);</div><div class="line">System.out.println(robot1);</div></pre></td></tr></table></figure></p>
<p>我们假设 <code>code</code> <code>name</code> <code>type</code> 是必填的参数，其他参数是可选的，我们想要的写法可能是下面这样的：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Robot robot2 = <span class="keyword">new</span> Robot(<span class="string">"89757"</span>, <span class="string">"火星一号"</span>, <span class="number">1</span>);</div></pre></td></tr></table></figure></p>
<p>奈何编译器可没那么智能，这样肯定会给出参数不匹配的 error 。我们只能老实的根据参数再去写一个构造函数：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">Robot</span><span class="params">(String code, String name, <span class="keyword">int</span> type)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.code = code;</div><div class="line">    <span class="keyword">this</span>.name = name;</div><div class="line">    <span class="keyword">this</span>.type = type;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当用户类型不同时，参数组合情况就会很多，难道还要每种都写一个吗？就算这样写了，也意味着构建时有多种对象状态，扩展起来也不方便，该怎么办呢？ Builder 模式虎躯一震：是时候展现真正的技术了。</p>
<h4 id="java-变种版"><a href="#Java-——-变种版" class="headerlink" title="Java —— 变种版"></a>Java —— 变种版</h4><p>为了应对可选参数过多的情况，我们可以将 <code>Robot.java</code> 改进成下面这样：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">Robot</span><span class="params">(RobotBuilder robotBuilder)</span> </span>&#123;</div><div class="line">       <span class="keyword">this</span>.code = robotBuilder.code;</div><div class="line">       <span class="keyword">this</span>.name = robotBuilder.name;</div><div class="line">       ...</div><div class="line">       <span class="keyword">this</span>.height = robotBuilder.height;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">RobotBuilder</span> </span>&#123;</div><div class="line">       <span class="keyword">private</span> String code;</div><div class="line">       <span class="keyword">private</span> String name;</div><div class="line">       ...</div><div class="line">       <span class="keyword">private</span> <span class="keyword">double</span> height;</div><div class="line"></div><div class="line">       <span class="comment">// 必填参数</span></div><div class="line">       <span class="function"><span class="keyword">public</span> <span class="title">RobotBuilder</span><span class="params">(String code, String name, <span class="keyword">int</span> type)</span> </span>&#123;</div><div class="line">           <span class="keyword">this</span>.code = code;</div><div class="line">           <span class="keyword">this</span>.name = name;</div><div class="line">           <span class="keyword">this</span>.type = type;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       <span class="comment">//选填参数</span></div><div class="line">       <span class="function"><span class="keyword">public</span> RobotBuilder <span class="title">withOptionalBattery</span><span class="params">(<span class="keyword">int</span> battery)</span> </span>&#123;</div><div class="line">           <span class="keyword">this</span>.battery = battery;</div><div class="line">           <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       ... <span class="comment">// 省略部分选填参数</span></div><div class="line"></div><div class="line">       <span class="function"><span class="keyword">public</span> Robot <span class="title">buildRobot</span><span class="params">()</span> </span>&#123;</div><div class="line">           ValidateRobotData();</div><div class="line">           <span class="keyword">return</span> <span class="keyword">new</span> Robot(<span class="keyword">this</span>);</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">ValidateRobotData</span><span class="params">()</span> </span>&#123;</div><div class="line">           <span class="comment">// 参数格式检查</span></div><div class="line">           <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>通过这种写法，可以减少对象创建过程中引入的多个构造函数、可选参数以及多个 setter 过度使用导致的不必要的复杂性。</p>
<p>测试：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Robot robot = <span class="keyword">new</span> Robot.RobotBuilder(<span class="string">"89757"</span>, <span class="string">"火星一号"</span>, <span class="number">1</span>)</div><div class="line">        .withOptionalBattery(<span class="number">99</span>)</div><div class="line">        .withOptionalAbility(<span class="number">250</span>)</div><div class="line">        .withOptionalWeight(<span class="number">180</span>)</div><div class="line">        .withOptionalHeight(<span class="number">180</span>)</div><div class="line">        .buildRobot();</div><div class="line"></div><div class="line">System.out.println(robot);</div></pre></td></tr></table></figure></p>
<p>这样的链式调用看起来比较优雅，同时对于可选参数也有语义化的引入方式。但是实际的情况可能会更糟糕一些：<code>Robot</code> 类中可能还会包含其他复杂对象，并且这些对象之间还存在一些构造顺序，下面将介绍传统的 Buidler 模式是如何解决这个问题的。</p>
<h3 id="java-传统版"><a href="#Java-——-传统版" class="headerlink" title="Java —— 传统版"></a>Java —— 传统版</h3><p>在写实际的例子之前，让我们先看一下 「四人帮」 提出的 Builder 模式的组成（推荐新手先看例子再回过头来看）</p>
<h5 id="builder-模式的构成"><a href="#Builder-模式的构成" class="headerlink" title="Builder 模式的构成"></a>Builder 模式的构成</h5><ol>
<li>建造者(Builder):<ul>
<li>Builder 为创建一个 Product 对象(对应文中 Robot)的各个部件指定抽象接口。</li>
</ul>
</li>
<li>抽象建造者(ConcreteBuilder):<ul>
<li>实现 Builder 的接口以构造和装配该产品的各个部件。</li>
<li>定义并明确它所创建的表示。</li>
<li>提供一个检索产品的接口</li>
</ul>
</li>
<li>导演类(Director)<ul>
<li>构造一个使用 Builder 接口的对象。</li>
</ul>
</li>
<li><p>产品类(Product)  </p>
<ul>
<li>表示被构造的复杂对象，ConcreteBuilder 创建该产品的内部表示并定义它的装配过程。</li>
<li>包含定义组成部件的类，包括将这些部件装配成最终产品的接口。</li>
</ul>
<p>看着是不是会有一点绕？还是先直接进入实际的场景部分吧！</p>
</li>
</ol>
<h5 id="如何让构造的对象有不同表示"><a href="#如何让构造的对象有不同表示" class="headerlink" title="如何让构造的对象有不同表示"></a>如何让构造的对象有不同表示</h5><p>不知道大家有没有看过「西部世界」，这部电影中的机器人展现出了高度智慧（没看过的话多啦A梦也可以吧），相信大家都想拿一个过来研究一下。</p>
<p>如果我们能够购买到这样的机器人，过程应该是这样的：</p>
<ol>
<li>我们（<code>Client</code>）和出厂商（<code>Director</code>）联系，告诉出厂商需要什么类型的机器人（<code>Product</code>)<br>；</li>
<li>出厂商接单后，设计师将我们需要的机器人的部件（<code>Builder</code>）进行分类筛选，发出构造指令；</li>
<li>不同生产人员（<code>ConcreteBuilder</code>）收到对应部件的构造命令；</li>
<li>各个组件被组装起来变成我们需要的机器人（<code>Product</code>）。</li>
</ol>
<h5 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h5><p>有了一个过程的概念，让我们看看代码是如何实现的（模拟的侧重点不同所以将 <code>Robot</code> 的参数改变）：</p>
<ol>
<li><p>厂家决定机器人有哪些结构</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Robot</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String sensor;</div><div class="line">    <span class="keyword">private</span> String control;</div><div class="line">    <span class="keyword">private</span> String drive;</div><div class="line">    <span class="keyword">private</span> String shell;</div><div class="line"></div><div class="line">    ... <span class="comment">//省略参数的 set 函数</span></div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"Robot &#123;"</span> +</div><div class="line">                <span class="string">"  Sensor = '"</span> + sensor + <span class="string">'\''</span> +</div><div class="line">                <span class="string">", Control = '"</span> + control + <span class="string">'\''</span> +</div><div class="line">                <span class="string">", Drive = '"</span> + drive + <span class="string">'\''</span> +</div><div class="line">                <span class="string">", Shell = '"</span> + shell + <span class="string">'\''</span> +</div><div class="line">                <span class="string">'&#125;'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>定义组装机器人的过程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">BuildSensor</span><span class="params">()</span></span>;  <span class="comment">// 构建传感器模块</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">BuildControl</span><span class="params">()</span></span>; <span class="comment">// 构建控制模块</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">BuildDrive</span><span class="params">()</span></span>;   <span class="comment">// 构建驱动模块</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">BuildShell</span><span class="params">()</span></span>;   <span class="comment">// 构建外壳</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Robot <span class="title">getRobot</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>实现生产工创造并组装组件的具体方式，返回拼装好的机器人</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteBuilder</span> <span class="keyword">extends</span> <span class="title">Builder</span> </span>&#123;</div><div class="line">    <span class="comment">//创建机器人实例</span></div><div class="line">    Robot robot = <span class="keyword">new</span> Robot();</div><div class="line"></div><div class="line">    <span class="comment">// 生产并组装部件</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">BuildSensor</span><span class="params">()</span> </span>&#123;</div><div class="line">      robot.setSensor(<span class="string">"创建并组装传感器"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    ... <span class="comment">// 省略部分 Build 函数</span></div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Robot <span class="title">getRobot</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> robot;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>下达指定给机器人生产与组装人员</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Director</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Construct</span><span class="params">(Builder builder)</span></span>&#123;</div><div class="line">        <span class="comment">// 按一定顺序组装机器人</span></div><div class="line">        builder.BuildSensor();</div><div class="line">        builder.BuildControl();</div><div class="line">        builder.BuildDrive();</div><div class="line">        builder.BuildShell();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>测试机器人</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Director director = <span class="keyword">new</span> Director();</div><div class="line">Builder builder = <span class="keyword">new</span> ConcreteBuilder();</div><div class="line"></div><div class="line">director.Construct(builder); <span class="comment">// 发出组装机器人的指令</span></div><div class="line">Robot robot = builder.getRobot(); <span class="comment">// 拿来拼装好的机器人</span></div><div class="line">System.out.println(robot); <span class="comment">// 展示机器人</span></div></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p>从上面的例子中看出我们只关心机器人是否正常运作，但是并不知道机器人拼装的过程。即这种模式的封装性很好。使用该模式可以有效的封装变化，在使用场景中，一般产品类（<code>Product</code>）和建造者(<code>Builder</code>)类是比较稳定的，因此，将主要的业务逻辑封装在导演类（<code>Director</code>）中对整体而言可以取得比较好的稳定性。</p>
<p>其次，建造者模式很容易进行扩展。如果有新的需求，通过实现一个新的建造者（<code>ConcreteBuilder</code>)类就可以完成，基本上不用修改之前的代码，因此对原有代码影响很小。</p>
<p>那么，在 Scala 中是否也存在 Java 的问题呢？</p>
<h2 id="scala-实现"><a href="#Scala-实现" class="headerlink" title="Scala 实现"></a>Scala 实现</h2><h4 id="仿-java-版"><a href="#仿-Java-版" class="headerlink" title="仿 Java 版"></a>仿 Java 版</h4><p>问题存在是毋庸置疑的，但我们最关心的应该是解决方法，Java 能干的 Scala 肯定也是能做的。在 Scala 中也有类似上文中 「Java —— 变种版」 的实现方式，我们还是采用 <code>Robot</code> 作为例子（因篇幅有限省略参数）：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Robot</span>(<span class="params">builder: <span class="type">RobotBuilder</span></span>) </span>&#123;</div><div class="line">    <span class="keyword">val</span> name = builder.name</div><div class="line">    <span class="keyword">val</span> nickname = builder.nickname</div><div class="line">    <span class="keyword">val</span> age = builder.age</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>然后定义一个 <code>Buidler</code> 类:<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">RobotBuilder</span> </span>&#123;</div><div class="line">  <span class="keyword">var</span> name = <span class="string">""</span></div><div class="line">  <span class="keyword">var</span> code = <span class="string">""</span></div><div class="line">  <span class="keyword">var</span> battery = <span class="number">0</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">setName</span></span>(name: <span class="type">String</span>): <span class="type">RobotBuilder</span> = &#123;</div><div class="line">    <span class="keyword">this</span>.name = name</div><div class="line">    <span class="keyword">this</span> <span class="comment">// 返回 this 链式调用</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  ... <span class="comment">// 省略两个 set 函数</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">build</span></span>() = &#123;</div><div class="line">    <span class="keyword">new</span> <span class="type">Robot</span>(<span class="keyword">this</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>测试：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> robot: <span class="type">Robot</span> = <span class="keyword">new</span> <span class="type">RobotBuilder</span>()</div><div class="line">  .setCode(<span class="string">"89757"</span>)</div><div class="line">  .setName(<span class="string">"Bat-Man"</span>)</div><div class="line">  .setBattery(<span class="number">88</span>)</div><div class="line">  .build()</div><div class="line"><span class="type">System</span>.out.println(<span class="string">s"Robot: <span class="subst">$robot</span> &#125;"</span>)</div></pre></td></tr></table></figure></p>
<p>这个与上方 Java 版本基本无异，当为 <code>Robot</code> 类添加新的字段也不必再创建新的构造器。仅需要通过 <code>RobotBuilder</code> 类进行兼容即可。</p>
<h4 id="case-class-版"><a href="#case-class-版" class="headerlink" title="case class 版"></a>case class 版</h4><p>但是我们可能忽略了一个问题：Scala 作为 「Object-Oriented Meets Functional」 的一门语言，推崇函数式编程和并发，比 Java 更加强调不变性。上文中的 <code>setXXX</code> 已经违背了这个特点，会带来副作用，这并不符合最佳实践。</p>
<p>好在 Scala 拥有样例类，这使得创造者模式的实现变得更加简单：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Robot</span>(<span class="params"></span></span></div><div class="line">                   name: <span class="type">String</span> = "",</div><div class="line">                   code:  <span class="type">String</span> = "",</div><div class="line">                   battery :<span class="type">Int</span> = 0</div><div class="line">                  )</div></pre></td></tr></table></figure></p>
<p>测试：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> robot1 = <span class="type">Robot</span>(</div><div class="line">  code = <span class="string">"89757"</span>,</div><div class="line">  name = <span class="string">"Bat-Man"</span>,</div><div class="line">  battery = <span class="number">99</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">val</span> robot2 = <span class="type">Robot</span>(name = <span class="string">"prefert"</span>)</div><div class="line"></div><div class="line"><span class="type">System</span>.out.println(<span class="string">s"Robot 1: <span class="subst">$robot1</span>"</span>)</div><div class="line"><span class="type">System</span>.out.println(<span class="string">s"Robot 2: <span class="subst">$robot2</span>"</span>)</div></pre></td></tr></table></figure></p>
<p>这种实现要比第一种实现更加简洁并且也更易维护，同时解决了第一种中不够 Pure 的缺点。</p>
<h4 id="类型安全type-safe-版"><a href="#类型安全-type-safe-版" class="headerlink" title="类型安全(type-safe) 版"></a>类型安全(<code>type-safe</code>) 版</h4><p>在创建对象的过程中，参数的初始化顺序可能是严格要求的（比如机器人遵循从里到外，从小到大的构造方式）。回顾前面两种方式，我们并不能完全控制参数的初始化顺序。</p>
<p>这里我们给<code>code</code> <code>name</code> 字段设置非空约束。为了确保这些参数都被设置，我们可以结合 <code>sealed</code> 关键字，利用 ADT 来达到这个目的（对 ADT 不熟悉的同学可以参考一下这篇文章<a href="http://scala.cool/2017/03/how-to-use-algebraic-data-type-in-scala-development/" target="_blank" rel="external">如何在 Scala 中利用 ADT 良好地组织业务</a>），同时对 <code>Robot</code> 类做一些修改：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Robot</span>(<span class="params"></span></span></div><div class="line">                  code: <span class="type">String</span>,</div><div class="line">                  name: <span class="type">String</span>,</div><div class="line">                  battery: <span class="type">Int</span></div><div class="line">                )</div><div class="line"></div><div class="line"><span class="comment">//  抽象类型定义了构建过程的不同步骤</span></div><div class="line"><span class="comment">// sealed 关键字要求我们要枚举所有的情况，被sealed 声明的 trait仅能被同一文件的的类继承</span></div><div class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">trait</span> <span class="title">BuildStep</span></span></div><div class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">trait</span> <span class="title">HasCodeStep</span> <span class="keyword">extends</span> <span class="title">BuildStep</span></span></div><div class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">trait</span> <span class="title">HasNameStep</span> <span class="keyword">extends</span> <span class="title">BuildStep</span></span></div></pre></td></tr></table></figure></p>
<p>然后我们改变一下 <code>RobotBuilder</code> 类 ：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// &lt;: 为类型上界符号，即 PassedStep 必须是 BuildStep 的子类</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">RobotBuilder</span>[<span class="type">PassedStep</span> &lt;: <span class="type">BuildStep</span>] <span class="title">private</span>(<span class="params"></span></span></div><div class="line">                                                     var code: <span class="type">String</span>,</div><div class="line">                                                     var name: <span class="type">String</span>,</div><div class="line">                                                     var battery: <span class="type">Int</span></div><div class="line">                                                   ) &#123;</div><div class="line"></div><div class="line">  <span class="comment">// 按实际需求重载构造器</span></div><div class="line">  <span class="keyword">protected</span> <span class="function"><span class="keyword">def</span> <span class="title">this</span></span>() = <span class="keyword">this</span>(<span class="string">""</span>, <span class="string">""</span>, <span class="number">0</span>)</div><div class="line"></div><div class="line">  <span class="keyword">protected</span> <span class="function"><span class="keyword">def</span> <span class="title">this</span></span>(pb: <span class="type">RobotBuilder</span>[_]) = <span class="keyword">this</span>(</div><div class="line">    pb.code,</div><div class="line">    pb.name,</div><div class="line">    pb.battery</div><div class="line">  )</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">setCode</span></span>(code: <span class="type">String</span>): <span class="type">RobotBuilder</span>[<span class="type">HasCodeStep</span>] = &#123;</div><div class="line">    <span class="keyword">this</span>.code = code</div><div class="line">    <span class="keyword">new</span> <span class="type">RobotBuilder</span>[<span class="type">HasCodeStep</span>](<span class="keyword">this</span>)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">setName</span></span>(name: <span class="type">String</span>)(<span class="keyword">implicit</span> ev: <span class="type">PassedStep</span> =:= <span class="type">HasCodeStep</span>): <span class="type">RobotBuilder</span>[<span class="type">HasNameStep</span>] = &#123;</div><div class="line">    <span class="keyword">this</span>.name = name</div><div class="line">    <span class="keyword">new</span> <span class="type">RobotBuilder</span>[<span class="type">HasNameStep</span>](<span class="keyword">this</span>)</div><div class="line">  &#125;</div><div class="line"></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">setBattery</span></span>(battery: <span class="type">Int</span>): <span class="type">RobotBuilder</span>[<span class="type">PassedStep</span>] = &#123;</div><div class="line">    <span class="keyword">this</span>.battery = battery</div><div class="line">    <span class="keyword">this</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line"></div><div class="line">  <span class="comment">// =:= 要求 ev 等于 HasAgeStep 类型</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">build</span></span>()(<span class="keyword">implicit</span> ev: <span class="type">PassedStep</span> =:= <span class="type">HasNameStep</span>): <span class="type">Robot</span> = <span class="type">Robot</span>(code, name, battery)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里将 builder 构造器设为 <code>private</code> 类型，即我们不可再使用 <code>new</code> 来创建 builder 了。并且返回类型变成了 <code>RobotBuilder[PassedStep]</code>。</p>
<p>另外我们给需要的方法添加了泛化类型约束，以 <code>build()</code> 函数为例，它限制 <code>HasNameStep</code> 步骤完成后构造器才能成功调用。</p>
<p>现在已经实现构造器已经对外不可见了，我们还需要提供一个命令入口。<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">RobotBuilder</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>() = <span class="keyword">new</span> <span class="type">RobotBuilder</span>[<span class="type">BuildStep</span>]()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>object</code> 在上一篇单例模式中提到过，单独出现时即单例对象(<code>Singleton Object</code>)，当与同名 <code>Class</code> 同时出现时，被称为 <code>class</code> 的伴生对象(<code>companion object</code>)，其中的 <code>apply()</code> 方法用于实例化伴生类。</p>
<p>测试：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> robot = <span class="type">RobotBuilder</span>()</div><div class="line">  .setName(<span class="string">"tyl"</span>)</div><div class="line">  .setCode(<span class="string">"89757"</span>)</div><div class="line">  .setBattery(<span class="number">99</span>)</div><div class="line">  .build()</div><div class="line"><span class="type">System</span>.out.println(<span class="string">s"Robot: <span class="subst">$robot</span>"</span>)</div></pre></td></tr></table></figure></p>
<p>如果我们少写了 <code>setName</code> 或 <code>setCode</code> 函数，或者颠倒了顺序，编译器都会给出类似下方的错误：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="type">Error</span>:(<span class="number">8</span>, <span class="number">13</span>) <span class="type">Cannot</span> prove that <span class="type">Builder</span>.<span class="type">Scala</span>.typesafe.<span class="type">BuildStep</span> =:= <span class="type">Builder</span>.<span class="type">Scala</span>.typesafe.<span class="type">HasCodeStep</span>.</div><div class="line">    .setName(<span class="string">"tyl"</span>)</div><div class="line"></div><div class="line">    <span class="type">Error</span>:(<span class="number">8</span>, <span class="number">13</span>) not enough arguments <span class="keyword">for</span> method setName: (<span class="keyword">implicit</span> ev: =:=[<span class="type">Builder</span>.<span class="type">Scala</span>.typesafe.<span class="type">BuildStep</span>,<span class="type">Builder</span>.<span class="type">Scala</span>.typesafe.<span class="type">HasCodeStep</span>])<span class="type">Builder</span>.<span class="type">Scala</span>.typesafe.<span class="type">RobotBuilder</span>[<span class="type">Builder</span>.<span class="type">Scala</span>.typesafe.<span class="type">HasNameStep</span>].</div><div class="line">    <span class="type">Unspecified</span> value parameter ev.</div><div class="line">        .setName(<span class="string">"tyl"</span>)</div></pre></td></tr></table></figure></p>
<p>因为能够支持在编译期间检查所编写的代码，所以对于需要检查类型的构造方式来说很可靠。</p>
<p>概括来说，<code>type safe</code> 版有如下的优缺点：</p>
<p>优点：</p>
<ul>
<li>对于严格按照顺序（存在相互依赖）的构造场景十分合适</li>
<li>泛化类型约束使得构造时不易出错</li>
</ul>
<p>缺点：</p>
<ul>
<li>对于不需要构造顺序的构造场景来说画蛇添足</li>
<li>参数可变导致副作用</li>
<li>不够简洁</li>
</ul>
<p>Scala 是一门高可扩展性语言，同样也提供了语法帮助我们缓解上述方法的缺点。</p>
<h4 id="require-版"><a href="#require-版" class="headerlink" title="require 版"></a>require 版</h4><p>在 Scala 中我们可以使用 <code>require</code> 关键字进行函数参数限制，类似 Java 中的 <code>assert</code>。<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Robot</span>(<span class="params"></span></span></div><div class="line">                  code:  <span class="type">String</span> = "",</div><div class="line">                  name: <span class="type">String</span> = "",</div><div class="line">                  battery :<span class="type">Int</span> = 0</div><div class="line">                  )&#123;</div><div class="line">  require(code != <span class="string">""</span>, <span class="string">"不可缺少 code 参数"</span>)</div><div class="line">  require(name != <span class="string">""</span>, <span class="string">"不可缺少 name 参数"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>代码非常简洁，并且也满足我们的需求，这才像函数式风格啊（另外数据验证我们也可以通过第三方类库 <code>refined</code> 来实现，感兴趣的同学可以看一看<a href="https://github.com/fthomas/refined" target="_blank" rel="external">refined: simple refinement types for Scala</a>！</p>
<p>测试：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">  <span class="keyword">val</span> robot2 = <span class="type">Robot</span>(name = <span class="string">"Bat-Man"</span>)</div><div class="line">&#125;<span class="keyword">catch</span> &#123;</div><div class="line">  <span class="keyword">case</span> e :<span class="type">Throwable</span> =&gt; e.printStackTrace()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如果我们在创建的时候少写参数，或者任何不符合 <code>require</code> 条件的行为都会导致抛出异常：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">java.lang.<span class="type">IllegalArgumentException</span>: requirement failed: 不可缺少 code 参数</div><div class="line">	at scala.<span class="type">Predef</span>$.require(<span class="type">Predef</span>.scala:<span class="number">277</span>)</div><div class="line">	at <span class="type">Builder</span>.<span class="type">Scala</span>.require.<span class="type">Robot</span>.&lt;init&gt;(<span class="type">Robot</span>.scala:<span class="number">12</span>)</div></pre></td></tr></table></figure></p>
<h2 id="总结"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><p>通过以上的例子我们可以得出 Builder 模式使用的场景大致如下：</p>
<ul>
<li>当对象具有大量可选参数时。</li>
<li>当创建复杂对象的算法应该独立于该对象的组成部分以及它们的装配方式时。</li>
<li>当构造过程必须允许被构造的对象有不同的表示时。</li>
</ul>
<p>另外，对比 Scala 和 Java 的实现，因为两者设计的初衷不同，所以也铸就了不同的语言特性。对于 Scala 而言，避免副作用是需要优先考虑的，当然 Scala 也有着很多语法糖来帮助开发者实现。<br>在 Java 和 Scala 中，实现 Buidler 模式的方式都很多，我们可以参考三种场景来选择恰当的方式实现，最大程度的提高开发效率。</p>
<p><a href="https://github.com/YarenTang/Design_Patterns_Examples/tree/master/src/Builder" target="_blank" rel="external">源码链接</a><br>如有错误和讲述不恰当的地方还请指出，不胜感激！</p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/07/09/scala-design-patterns-1-singleton/" class="prev">PREV</a><a href="/2017/07/27/scala-design-patterns-3-prototype/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'prefer-tyl-site';
var disqus_identifier = '2017/07/20/scala-design-patterns-2-builder/';
var disqus_title = 'Scala 与设计模式（二）：Builder 创建者模式';
var disqus_url = 'http://prefer-tyl.site/2017/07/20/scala-design-patterns-2-builder/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//prefer-tyl-site.disqus.com/count.js" async></script><div class="copyright"><p>© 2017 <a href="http://prefer-tyl.site">Prefert</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>