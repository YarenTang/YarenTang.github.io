<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Dive Into Kotlin（一）：初探 Kotlin · Prefert</title><meta name="description" content="Dive Into Kotlin（一）：初探 Kotlin - Prefert"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/avator.jpg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://prefer-tyl.site/atom.xml" title="Prefert"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/avator.jpg" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/YarenTang" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Dive Into Kotlin（一）：初探 Kotlin</h1><div class="post-info">Nov 5, 2017</div><div class="post-content"><p>在今年的 <a href="https://www.youtube.com/watch?v=Y2VF8tmLFHw" target="_blank" rel="external">Google I/O</a> 大会上，Google 宣布在 Android 上为 Kotlin 提供一等支持（转为正房）。  </p>
<p>在 Andorid 开发的圈子中，这无疑掀起了轩然大浪。对部分人来说，也许这是第一次听到 「Kotlin 」。事实上，在2011年7月，JetBrains 就推出 Kotlin 项目，直到去年2月份 Kotlin v1.0 才正式发布。    </p>
<a id="more"></a>
<p>本文将简单介绍 Kotlin 的生态系统和部分语言功能。</p>
<!-- toc -->
<ul>
<li><a href="#kotlin-是一门怎么样的语言">Kotlin 是一门怎么样的语言？</a><ul>
<li><a href="#kotlin-核心的目标">Kotlin 核心的目标</a></li>
</ul>
</li>
<li><a href="#强大的生态圈">强大的生态圈</a></li>
<li><a href="#特征">特征</a><ul>
<li><a href="#属性前置">属性前置</a></li>
<li><a href="#函数式编程是变革的关键">函数式编程是变革的关键</a></li>
<li><a href="#kotlin-重新定义了函数的写法">Kotlin 重新定义了函数的写法</a></li>
<li><a href="#函数可读性">函数可读性</a></li>
<li><a href="#类型安全">类型安全</a></li>
<li><a href="#lambda-优化">Lambda 优化</a></li>
<li><a href="#条件判断更优雅">条件判断更优雅</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<h2 id="kotlin-是一门怎么样的语言"><a href="#Kotlin-是一门怎么样的语言？" class="headerlink" title="Kotlin 是一门怎么样的语言？"></a>Kotlin 是一门怎么样的语言？</h2><p>Kotlin 是一种在 JVM 上运行的静态类型编程语言，可以编译成Java字节码，也可以编译成 JavaScript，方便在没有 JVM 的设备上运行。  </p>
<h3 id="kotlin-核心的目标"><a href="#Kotlin-核心的目标" class="headerlink" title="Kotlin 核心的目标"></a>Kotlin 核心的目标</h3><ul>
<li><p><strong>简约</strong>：帮你减少实现同一个功能的代码量。  </p>
</li>
<li><p><strong>易懂</strong>：让你的代码更容易阅读，同时易于理解。  </p>
</li>
<li><p><strong>安全</strong>：移除了你可能会犯错误的功能。  </p>
</li>
<li><p><strong>通用</strong>：基于 JVM 和 Javascript，你可以在很多地方运行。  </p>
</li>
<li><p><strong>互操作性</strong>：这就意味着 Kotlin 和 Java 可以相互调用，同时 Jetbrains 的目标是让他们 100% 兼容。  </p>
</li>
</ul>
<p>对比 Java，Kotlin 或许显得有点年轻，但这并不代表它的生态系统不够稳定。</p>
<h2 id="强大的生态圈"><a href="#强大的生态圈" class="headerlink" title="强大的生态圈"></a>强大的生态圈</h2><p><strong>Kotlin 编译为 JVM 字节码或 JavaScript</strong><br>它可以吸引所有使用垃圾回收机制语言的程序员，包括 Java，Scala，Go，Python， Ruby 和 JavaScript。</p>
<p><strong>kotlin 产自工业，而不是学术界。</strong><br>它解决了程序员目前所面临的一些问题。举个例子：类型系统可以帮助你避免空指针异常。当我们在使用一些 API 或者大型库时判断是否为 null，往往没有什么实际作用。</p>
<p><strong>Kotlin 完美兼容 Java</strong><br>在 Idea 中，你可以一键实现 Java 与 Kotlin 的转换。也就是说， Kotlin 写的项目中可以使用所有现有的 Java 框架和库，甚至是依赖于注解的高级框架，并且它整合了 Maven，Gradle 和其他构建工具——帮助我们实现无缝的互操作。  </p>
<p><strong>Kotlin 相对入门简单</strong><br>所以正如大家所说的那样，Kotlin 是一门十分友好的语言，你甚至可以花几个小时阅读下相关书籍就能入门。它的语法简洁直观，也许大多时候看起来比较像 Scala，实际上简单了很多。这种语言很好地平衡了简洁和可读性。</p>
<p><strong>不施加运行时间的开销</strong><br>标准库是比较小的：主要是对 Java 标准库的重点扩展。大量使用编译时内联（compile-time inlining）就意味着像 <code>map</code>、 <code>filter</code>、 <code>reduce</code> 这样的语法编译起来与命令式的相似。</p>
<p><strong>Android扩展库</strong><br><a href="https://github.com/Kotlin/anko" target="_blank" rel="external">Anko</a> 与 <a href="http://kovenant.komponents.nl/android/features/" target="_blank" rel="external">kovenant</a> 让 Kotlin 在 Android 的开发中更加方便，如果你看过这两个库，一定也为之青睐。</p>
<p>除 Android 外，其实企业级别的 Java 项目也可以考虑使用 Kotlin：  </p>
<ol>
<li><p><strong>它有一个成熟的公司强大的商业支持</strong>，JetBrains 致力于该项目的房展，拥有一支高效的团队和稳定的商业模式。在较长的时间内，你都不用担心 Kotlin 被抛弃。  </p>
</li>
<li><p><strong>Kotlin 的风险很低</strong>：可以由一两个成员尝试在某个功能块使用，但并不会影响其他模块：Kotlin 类可以导出一个与常规 Java 代码看起来相同的 Java API。</p>
</li>
<li><p><strong>Java 6 废土中的一线希望</strong>：如果升级 JVM 对于你们的成本很高，你可以使用 Kotlin，它是「加强版的 Java 6」。</p>
</li>
</ol>
<p>看完生态系统，来看看最吸引我们的语言功能。</p>
<h2 id="特征"><a href="#特征" class="headerlink" title="特征"></a>特征</h2><p><img src="http://ovib8fj5v.bkt.clouddn.com/kotlin&amp;&amp;android.png" alt="kotlin&amp;&amp;Android">  </p>
<h4 id="属性前置"><a href="#属性前置" class="headerlink" title="属性前置"></a>属性前置</h4><p>Java Bean 中总是出现一些重复工作量的代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span></span>&#123;</div><div class="line">String name;</div><div class="line"><span class="keyword">int</span> age;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">Customer</span><span class="params">(String name, <span class="keyword">int</span> age)</span></span>&#123;</div><div class="line"><span class="keyword">this</span>.name=name;</div><div class="line"><span class="keyword">this</span>.age=age;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</div><div class="line"><span class="keyword">return</span> name;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span></span>&#123;</div><div class="line"><span class="keyword">return</span> age;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">setName</span><span class="params">(String name)</span></span>&#123;</div><div class="line"><span class="keyword">this</span>.name=name;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span></span>&#123;</div><div class="line"><span class="keyword">this</span>.age=age;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在 Java 对象中，构造函数和属性的 <code>Getter</code>、<code>Setter</code> 函数在每个Bean类中都会出现，看起来非常冗余。  </p>
<p>但是使用 Kotlin，代码是这样的：<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span></span>(<span class="keyword">val</span> name:String, <span class="keyword">val</span> age:<span class="built_in">Int</span>)</div></pre></td></tr></table></figure></p>
<p>Kotlin 将<code>Getter</code>、<code>Setter</code> 等函数省略，让我们更加关注属性。</p>
<h4 id="函数式编程是变革的关键"><a href="#函数式编程是变革的关键" class="headerlink" title="函数式编程是变革的关键"></a>函数式编程是变革的关键</h4><p>如果你是一名 「FP」 （Functional Programming） 爱好者，你肯定知道 <a href="https://zh.wikipedia.org/wiki/Scala" target="_blank" rel="external">Scala</a>  这门语言。而 Kotlin 的设计初衷就是提供 Scala 里的很多特性，但不被编译时间束缚。  </p>
<p><img src="http://om6vvgjw7.bkt.clouddn.com/FP.jpg" alt="FP">  </p>
<p>网上对函数式编程的介绍，大多数对初学者都是不够友好的，下面是一种比较简洁的概括：</p>
<blockquote>
<p>函数编程以基于数学的函数构成，实现一个功能时倾向于实现的目标，而不是实现目标的方式。  </p>
</blockquote>
<p>也就是说，函数式编程处理的是不可变的数据，即不会改变变量的值。它所做的只是 Receive（接收）-&gt; Compute（计算）-&gt; Return（返回） ，而不改变它接收到的值，或者引起<a href="https://zh.wikipedia.org/wiki/%E5%87%BD%E6%95%B0%E5%89%AF%E4%BD%9C%E7%94%A8" target="_blank" rel="external">「副作用」</a>。  </p>
<h4 id="kotlin-重新定义了函数的写法"><a href="#Kotlin-重新定义了函数的写法" class="headerlink" title="Kotlin 重新定义了函数的写法"></a>Kotlin 重新定义了函数的写法</h4><ul>
<li>简化函数重载。</li>
<li>命名参数不遵循顺序：命名参数允许完全控制什么值被传递给变量，并在与布尔处理，举个例子：  </li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Java</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">check</span><span class="params">(<span class="keyword">boolean</span> isAlpha, <span class="keyword">boolean</span> isNum)</span></span>&#123;<span class="comment">//函数定义</span></div><div class="line">&#125;</div><div class="line">check(<span class="keyword">true</span>，<span class="keyword">false</span>); <span class="comment">//函数调用</span></div><div class="line"></div><div class="line"><span class="comment">// Kotlin</span></div><div class="line"><span class="function">fun <span class="title">check</span><span class="params">(isAlpha:Boolean, isNum：Boolean = <span class="keyword">false</span>)</span> </span>&#123;</div><div class="line">   <span class="comment">// do something</span></div><div class="line">&#125;</div><div class="line">check(<span class="keyword">true</span>)<span class="comment">// 1</span></div><div class="line">check(<span class="keyword">true</span>,<span class="keyword">true</span>)<span class="comment">// 2</span></div><div class="line">check(isAlpha = <span class="keyword">true</span>, isNum = <span class="keyword">false</span>) <span class="comment">// 3</span></div><div class="line">check(isNum = <span class="keyword">false</span>, isAlpha = <span class="keyword">true</span>) <span class="comment">// 4</span></div></pre></td></tr></table></figure>
<p>其中1、3、4实际效果一致。</p>
<h4 id="函数可读性"><a href="#函数可读性" class="headerlink" title="函数可读性"></a>函数可读性</h4><ul>
<li>单行表达式是提高代码可读性的第一步。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span>  <span class="title">sum</span> <span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123; <span class="comment">// 返回类型必须声明。</span></div><div class="line">X = X + Y; <span class="comment">// x的值被改变，是一个副作用。</span></div><div class="line"><span class="keyword">return</span> x;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// kotlin</span></div><div class="line"><span class="function">fun <span class="title">sum</span><span class="params">(x：Int, y：Int)</span></span>= x + y <span class="comment">//完美。</span></div></pre></td></tr></table></figure>
<p>在 Android 开发时，我们应该都会对视图的 <code>onClick</code> 事件感到烦躁。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Java</span></div><div class="line">view.setOnClickListener(<span class="keyword">new</span> View.OnClickKistener() &#123;</div><div class="line">@ <span class="function">Override</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span>&#123;</div><div class="line">System.out.println(<span class="string">"sad"</span>);</div><div class="line">&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>在 kotlin 中，这也得到简化：<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">view.onClick &#123;</div><div class="line">println（<span class="string">"nice !!"</span>）</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="类型安全"><a href="#类型安全" class="headerlink" title="类型安全"></a>类型安全</h4><p>在 Android 开发中，出现 <code>NullPointerExceptio</code> 已经可以说是家常便饭了，在运行的时候才出现这个异常，对用户体验造成的损失是巨大的。  </p>
<p>Kotlin 能很好的避免这个问题：  </p>
<ul>
<li>指定 null  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Java</span></div><div class="line">String text1 = <span class="keyword">null</span> <span class="comment">// NE</span></div><div class="line"><span class="comment">// Kotlin</span></div><div class="line">var text1：String = <span class="string">"Kotlin"</span><span class="comment">// 正常</span></div><div class="line">var text2：String = <span class="keyword">null</span> <span class="comment">// NE</span></div><div class="line">var text3：String?= <span class="keyword">null</span> <span class="comment">// 正常</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>Kotlin 中只有加了 <code>?</code> 才允许为null。</strong>  </p>
<ul>
<li><p>检查 null<br>Kotlin 可以通过 <code>?</code>确保安全调用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Java</span></div><div class="line"><span class="keyword">if</span>（a != <span class="keyword">null</span>）&#123;</div><div class="line"><span class="keyword">int</span> x = a.length（）;</div><div class="line">&#125;</div><div class="line"><span class="comment">// Kotlin</span></div><div class="line">val x = a？.length <span class="comment">//仅当a不为null时才编译</span></div></pre></td></tr></table></figure>
</li>
<li><p>为 null 时默认值  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">val x = b?.length ?: <span class="number">0</span> <span class="comment">// 如果b为 null，那他的 length 就为0</span></div><div class="line">val x = b?.length ?: <span class="keyword">throw</span> NullPointerException()</div><div class="line">val x = b!!.length</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="lambda-优化"><a href="#Lambda-优化" class="headerlink" title="Lambda 优化"></a>Lambda 优化</h4><p>Lambda 表达式增加了 Kotlin 的简洁功能，从而也带来了易理解的代码。(Java 6 不支持 lambda )<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> sum = &#123;x：<span class="built_in">Int</span>，y：<span class="built_in">Int</span>  - &gt; x + y&#125; <span class="comment">//类型：（Int，Int） - &gt; Int</span></div><div class="line"><span class="keyword">val</span> result = sum（<span class="number">2</span>,<span class="number">7</span>）<span class="comment">// result == 9</span></div></pre></td></tr></table></figure></p>
<h4 id="条件判断更优雅"><a href="#条件判断更优雅" class="headerlink" title="条件判断更优雅"></a>条件判断更优雅</h4><p>在 kotlin 中 <code>when</code> 也能给你惊喜：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Java</span></div><div class="line"><span class="keyword">if</span>(x==<span class="number">1</span>)</div><div class="line">println(<span class="string">"x is 1"</span>);</div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span>(x==<span class="number">2</span>)</div><div class="line">println(<span class="string">"x is 2"</span>);</div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span>(x==<span class="number">3</span>||x==<span class="number">4</span>)</div><div class="line">println(<span class="string">"x is 3 or 4"</span>);</div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span>(x&gt;=<span class="number">5</span>||x&lt;=<span class="number">10</span>)</div><div class="line">println(<span class="string">"x is 5, 6, 7, 8, 9, or 10"</span>);</div><div class="line"><span class="keyword">else</span></div><div class="line">println(<span class="string">"x is out of range"</span>);</div><div class="line"><span class="comment">//Kotlin</span></div><div class="line">when (x) &#123;</div><div class="line">    <span class="number">1</span> -&gt; print(<span class="string">"x is 1"</span>)</div><div class="line">    <span class="number">2</span> -&gt; print(<span class="string">"x is 2"</span>)</div><div class="line">    <span class="number">3</span>, <span class="number">4</span> -&gt; print(<span class="string">"x is 3 or 4"</span>)</div><div class="line">    in <span class="number">5</span>..<span class="number">10</span> -&gt; print(<span class="string">"x is 5, 6, 7, 8, 9, or 10"</span>)</div><div class="line">    <span class="keyword">else</span> -&gt; print(<span class="string">"x is out of range"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当然除了以上这些，Kotlin 还有许多令人惊喜的特性，将会在后续的文章中详细介绍，敬请期待。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/08/19/scala-design-patterns-4-factory/" class="prev">PREV</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'prefer-tyl-site';
var disqus_identifier = '2017/11/05/kotlin-0/';
var disqus_title = 'Dive Into Kotlin（一）：初探 Kotlin';
var disqus_url = 'http://prefer-tyl.site/2017/11/05/kotlin-0/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//prefer-tyl-site.disqus.com/count.js" async></script><div class="copyright"><p>© 2017 <a href="http://prefer-tyl.site">Prefert</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>